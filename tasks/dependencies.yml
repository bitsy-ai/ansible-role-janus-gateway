---
# tasks file for ansible-role-janus-gateway
- name: Install required platform dependencies
  become: true
  apt:
    update_cache: true
    name:
      - libmicrohttpd-dev
      - libjansson-dev
      - libssl-dev
      - libsofia-sip-ua-dev
      - libglib2.0-dev
      - libopus-dev
      - libogg-dev
      - libcurl4-openssl-dev
      - liblua5.3-dev
      - libconfig-dev
      - pkg-config
      - gengetopt
      - libtool
      - automake
      - build-essential
      - git
      - python3-pip
      - wget
      - systemd 
      - systemd-cron
    state: present
  tags:
    janus-gateway

- name: Install rabbitmq dependencies
  when: janus_build_extras['rabbitmq']
  fail: 
    msg: RabbitMQ for Janus event/API is not yet supported by this role. Please open a pull request with build play for https://github.com/alanxz/rabbitmq-c
  tags:
    janus-gateway

- name: Install mqtt dependencies
  when: janus_build_extras['mqtt']
  fail: 
    msg: MQTT for Janus events/API is not yet supported by this role. Please open a pull request with build play for https://eclipse.org/paho/clients/c
  tags:
    janus-gateway

- name: Install Nanomsg dependencies
  when: janus_build_extras['nanomsg']
  fail: 
    msg: nanomsg for Janus API is not yet supported by this role. Please open a pull request with build play for https://eclipse.org/paho/clients/c
  tags:
    janus-gateway

- name: Install libwebsockets dependencies
  become: true
  when: janus_build_extras['websockets']
  apt:
    name:
      - cmake

    state: present
  tags:
    janus-gateway

- name: Register gcc machine arch
  command:
    cmd: gcc -dumpmachine
  register: gcc_dumpmachine
  changed_when: False # disable idempotency check (expected to always run)
